<div fxLayout="column"
     fxLayoutAlign="center center">
  <div fxLayout="column">
    <div *ngFor="let key of objectKeys(item)">
      <div *ngIf="shouldDisplay(key)">
        <div *ngIf="isStringOrNumber(key)"
             fxLayout="row"
             fxLayoutAlign="center">
          <ng-container *ngIf="!canEdit(key); then uneditableField"></ng-container>
          <ng-container *ngIf="isEditableField(key); then editableField"></ng-container>
          <ng-container *ngIf="isBooleanToggle(key); then booleanToggle"></ng-container>
          <ng-container *ngIf="isAlert(key); then alertChoice"></ng-container>
          <ng-container *ngIf="isColorMode(key); then colorMode"></ng-container>
          <ng-container *ngIf="isEffect(key); then alertChoice"></ng-container>
          <ng-container *ngIf="isInLightArray(parentKey); then lightPicker"></ng-container>
          <ng-container *ngIf="isInLightArray(parentKey); then arrayDeleteButton"></ng-container>

          <ng-template #uneditableField>
            <label fxFlexOffset="2">{{key}}:</label>
            <label fxFlexOffset="2">{{item[key]}}</label>
          </ng-template>

          <ng-template #editableField>
            <label fxFlexOffset="2">{{key}}:</label>
            <input fxFlexOffset="2"
                   [(value)]="item[key]">
          </ng-template>

          <ng-template #booleanToggle>
            <label fxFlexOffset="2">{{key}}:</label>
            <label class="btn-xs btn-primary"
                   fxFlexOffset="4"
                   (click)=toggle(key)>{{item[key]}}</label>
          </ng-template>

          <!-- color, flashing, etc picker -->
          <ng-template #effectChoice>
            <mat-form-field>
              <mat-select [(ngModel)]="item[key]"
                          placeholder="Color Effect">
                <mat-option value="none">none</mat-option>
                <mat-option value="colorloop">colorloop</mat-option>
              </mat-select>
            </mat-form-field>
          </ng-template>

          <!-- Alert mode picker -->
          <ng-template #alertChoice>
            <mat-form-field>
              <mat-select [(ngModel)]="item[key]"
                          placeholder="Light alert">
                <mat-option value="none">none</mat-option>
                <mat-option value="select">select</mat-option>
                <mat-option value="lselect">lselect</mat-option>
              </mat-select>
            </mat-form-field>
          </ng-template>

          <!-- Dropdown for choosing lights -->
          <ng-template #lightPicker>
            <mat-form-field>
              <mat-select [(ngModel)]="item[key]"
                          placeholder="Light Name">
                <mat-option *ngFor="let lightKey of objectKeys(lights)"
                            [value]="lightKey">{{lights[lightKey].name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </ng-template>

          <!-- color mode selector -->
          <ng-template #colorMode>
            <mat-form-field>
              <mat-select [(ngModel)]="item[key]"
                          placeholder="Color Mode">
                <mat-option value="hs">hs</mat-option>
                <mat-option value="xy">xy</mat-option>
                <mat-option value="ct">ct</mat-option>
              </mat-select>
            </mat-form-field>
          </ng-template>

          <!-- add a minus button next to the array item if it can be removed -->
          <ng-template #arrayDeleteButton>
            <label class="btn-xs btn-primary"
                   fxFlexOffset="2"
                   (click)=removeItem(key)>-</label>
          </ng-template>
        </div>

        <!-- Recurse into the next item -->
        <div *ngIf="!isStringOrNumber(key)"
             fxLayout="row">
          <label fxFlexOffset="2">{{key}}: </label>
          <app-item-display fxFlexOffset="2"
                            [itemKey]="key"
                            [itemType]="itemType"
                            [allUneditable]="allUneditable"
                            [(originalItemId)]="originalItemId"
                            [(item)]="item[key]"
                            [(lights)]="lights">
          </app-item-display>
        </div>
      </div>
    </div>

    <div *ngIf="isState(key)"
         class="btn-group"
         fxLayout="row"
         fxLayoutAlign="center center">
      <button type="button"
              class="btn-sm btn-primary"
              (click)="onResetState()">
        Reset State
      </button>
      <button type="button"
              class="btn-sm btn-success"
              (click)="onSubmitState(submitStateModal)">
        Submit State
      </button>
    </div>

    <div *ngIf="isLightArray(key)"
         fxLayout="row"
         fxLayoutAlign="none center">
      <label class="btn-xs btn-primary"
             fxFlexOffset="0"
             fxFlex="none"
             (click)=addItem()>+</label>
    </div>

  </div>
</div>

<ng-template #submitStateModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Submission Results</h4>
    <button type="button"
            class="close pull-right"
            aria-label="Close"
            (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div fxLayout="column"
         fxLayoutAlign="center center">
      <div>
        State values are now as follows:
      </div>
      <div *ngFor="let resultKey of objectKeys(submitStateResults.singleResult)">
        <label fxFlexOffset="2">{{key}}:</label>
        <label fxFlexOffset="2">{{item[key]}}</label>
      </div>
    </div>
  </div>
</ng-template>